{"version":3,"sources":["track.ts"],"names":["payload","event","properties","campaign","attributionData","network","source","name","adGroup","ad_group","creative","ad_creative","ReactAppboy","setAttributionData","revenue","extractRevenue","currency","length","appBoyProperties","Object","assign","products","slice","forEach","product","productDict","productId","productRevenue","productQuantity","quantity","price","productProperties","logPurchase","String","logCustomEvent","key","parseFloat"],"mappings":"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","sourcesContent":["import ReactAppboy from 'react-native-appboy-sdk';\nimport type { TrackEventType, JsonMap } from '@segment/analytics-react-native';\n\nexport default (payload: TrackEventType) => {\n  if (payload.event === 'Install Attributed') {\n    if (payload.properties?.campaign) {\n      const attributionData: any = payload.properties.campaign;\n      const network = attributionData.source;\n      const campaign = attributionData.name;\n      const adGroup = attributionData.ad_group;\n      const creative = attributionData.ad_creative;\n      ReactAppboy.setAttributionData(network, campaign, adGroup, creative);\n    }\n  }\n\n  const revenue = extractRevenue(payload.properties, 'revenue');\n  if (revenue || payload.event === 'Order Completed') {\n    // Make USD as the default currency.\n    let currency = 'USD';\n    if (\n      typeof payload.properties?.currency === 'string' &&\n      payload.properties.currency.length === 3\n    ) {\n      currency = payload.properties.currency;\n    }\n    if (payload.properties) {\n      const appBoyProperties = Object.assign({}, payload.properties);\n      delete appBoyProperties.currency;\n      delete appBoyProperties.revenue;\n\n      if (appBoyProperties.products) {\n        const products = (appBoyProperties.products as any[]).slice(0);\n        delete appBoyProperties.products;\n\n        products.forEach((product) => {\n          const productDict = Object.assign({}, product);\n          const productId = productDict.productId;\n          const productRevenue = extractRevenue(productDict, 'price');\n          const productQuantity = productDict.quantity;\n          delete productDict.productId;\n          delete productDict.price;\n          delete productDict.quantity;\n          let productProperties = Object.assign(\n            {},\n            appBoyProperties,\n            productDict\n          );\n          ReactAppboy.logPurchase(\n            productId,\n            String(productRevenue),\n            currency,\n            productQuantity,\n            productProperties\n          );\n        });\n      } else {\n        ReactAppboy.logPurchase(\n          payload.event,\n          String(revenue),\n          currency,\n          1,\n          appBoyProperties\n        );\n      }\n    } else {\n      ReactAppboy.logPurchase(payload.event, String(revenue), currency, 1);\n    }\n  } else {\n    ReactAppboy.logCustomEvent(payload.event, payload.properties);\n  }\n\n  return payload;\n};\n\nconst extractRevenue = (properties: JsonMap | undefined, key: string) => {\n  if (!properties) {\n    return 0;\n  }\n\n  const revenue = properties[key];\n  if (revenue) {\n    switch (typeof revenue) {\n      case 'string':\n        return parseFloat(revenue);\n      case 'number':\n        return revenue;\n      default:\n        return 0;\n    }\n  } else {\n    return 0;\n  }\n};\n"]}